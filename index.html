<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Travel Assistant</title>
<style>
  /* ---------- Base ---------- */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html,body { height: 100%; }
  body {
    font-family: 'Courier New', Courier, monospace;
    background: #0a0a0a;
    color: #fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* ---------- Top Right Buttons ---------- */
  .settings-btn {
    position: fixed; top: 20px; right: 20px;
    padding: 12px 20px; background: rgba(255,255,255,0.05);
    border: 2px solid #333; color: #888; font-weight:900;
    cursor:pointer; text-transform:uppercase; letter-spacing:2px;
    font-size:11px; z-index:1200;
  }
  .help-btn { right: 160px; }
  .settings-btn:hover { border-color:#00ff87; color:#00ff87; }

  /* FIX: Override for itinerary buttons specifically */
  .itinerary-btn {
    position: static !important;
    right: auto !important;
    top: auto !important;
    width: 100%;
    margin-top: 12px;
  }

  /* ---------- Modals ---------- */
  .modal { position:fixed; top:0; left:0; width:100%; height:100%; display:none; align-items:center; justify-content:center; z-index:1200; }
  .modal.show { display:flex; }
  .modal-content {
    background:#1a1a1a; border:2px solid #00ff87; padding:40px; width:90%; max-width:600px; max-height:90vh; overflow:auto; position:relative;
  }
  .modal-close { position:absolute; top:12px; right:12px; background:transparent; border:none; color:#666; font-size:28px; cursor:pointer; }
  .modal-close:hover { color:#00ff87; transform:rotate(90deg); }
  .modal-title { font-size:20px; color:#00ff87; font-weight:900; text-transform:uppercase; margin-bottom:12px; letter-spacing:2px; }
  .modal-text { color:#888; font-size:13px; line-height:1.6; margin-bottom:18px; }

  /* ---------- Start Page ---------- */
  .start-page { min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px; background:linear-gradient(180deg,#0a0a0a,#1a1a1a); }
  .start-page.hidden { display:none; }
  .logo-large { font-size:72px; font-weight:900; letter-spacing:-2px; margin-bottom:20px; text-transform:uppercase;
    background: linear-gradient(135deg,#00ff87,#60efff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  .tagline { color:#666; margin-bottom:40px; text-transform:uppercase; letter-spacing:4px; font-weight:700; }
  .intent-wrapper { width:100%; max-width:800px; background: rgba(255,255,255,0.03); border:2px solid #00ff87; backdrop-filter: blur(6px); }
  .intent-input { width:100%; padding:36px; background:transparent; border:none; color:#fff; font-size:20px; font-weight:700; min-height:120px; font-family:'Courier New',monospace; }
  .intent-actions { display:flex; justify-content:space-between; padding:18px 28px; background:rgba(0,0,0,0.45); border-top:2px solid #00ff87; }
  .voice-btn { padding:12px 20px; background:#00ff87; border:none; color:#0a0a0a; font-weight:900; cursor:pointer; }
  .voice-btn.listening { background:#ff0055; animation:pulse 1.5s infinite; }
  @keyframes pulse { 0%,100% { opacity:1 } 50% { opacity:0.7 } }

  .suggestions { margin-top:24px; display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:12px; max-width:800px; width:100%; }
  .suggestion { padding:14px; text-align:center; text-transform:uppercase; color:#888; border:1px solid #333; background:rgba(255,255,255,0.02); cursor:pointer; font-weight:700; }
  .suggestion:hover { border-color:#00ff87; color:#00ff87; background:rgba(0,255,135,0.05); }

  /* ---------- Main App ---------- */
  .main-app { display:none; min-height:100vh; }
  .main-app.active { display:block; }
  .header { padding:20px 28px; background:#0a0a0a; border-bottom:2px solid #00ff87; display:flex; justify-content:space-between; align-items:center; }
  .logo { color:#00ff87; font-weight:900; text-transform:uppercase; letter-spacing:-1px; font-size:20px; }
  .badge { background:#00ff87; padding:6px 12px; color:#0a0a0a; font-weight:900; text-transform:uppercase; letter-spacing:2px; font-size:11px; margin-left:12px; }

  .progress { display:flex; background:#0a0a0a; border-bottom:1px solid #222; }
  .progress-step { flex:1; text-align:center; padding:12px; color:#444; font-weight:900; font-size:11px; text-transform:uppercase; letter-spacing:2px; border-right:1px solid #222; transition: all 200ms ease; position:relative; }
  .progress-step:last-child { border-right:none; }
  .progress-step.active { color:#00ff87; background: rgba(0,255,135,0.05); border-bottom:3px solid #00ff87; animation: progressPulse 700ms ease; }
  @keyframes progressPulse { 0% { box-shadow: 0 0 0 rgba(0,255,135,0); } 50% { box-shadow: 0 6px 18px rgba(0,255,135,0.08);} 100% { box-shadow: 0 0 0 rgba(0,255,135,0); } }

  .content { display:grid; grid-template-columns: 1fr 360px; gap:0; background:#0a0a0a; }
  @media (max-width: 1080px) { .content { grid-template-columns: 1fr 320px; } }
  @media (max-width: 768px) { .content { grid-template-columns: 1fr; } }

  .panel { padding:28px; border-right:1px solid #222; min-height: calc(100vh - 120px); }
  .panel:last-child { border-right:none; }
  .panel-title { color:#fff; font-size:18px; font-weight:900; margin-bottom:18px; text-transform:uppercase; border-bottom:2px solid #00ff87; padding-bottom:12px; }

  .tabs { display:flex; border:2px solid #333; margin-bottom:18px; }
  .tab { flex:1; padding:10px; background:transparent; border:none; border-right:1px solid #333; color:#666; font-weight:900; cursor:pointer; text-transform:uppercase; letter-spacing:2px; font-size:12px; }
  .tab:last-child { border-right:none; }
  .tab.active { background:#00ff87; color:#0a0a0a; }

  .tab-content { display:none; }
  .tab-content.active { display:block; }

  .search-btn { width:100%; padding:14px; background:#00ff87; border:none; color:#0a0a0a; font-weight:900; cursor:pointer; text-transform:uppercase; letter-spacing:3px; margin-top:12px; }
  .search-btn:hover { background:#60efff; }
  .results { margin-top:18px; }

  .loading { text-align:center; padding:30px; color:#00ff87; font-size:13px; text-transform:uppercase; letter-spacing:2px; }

  .form-group { margin-bottom: 16px; }
  .form-label { display: block; color: #888; font-size: 12px; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 1px; }
  .form-group input, .form-group select { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #333; color: #fff; font-family: 'Courier New', monospace; }

  /* ---------- Cards ---------- */
  .card {
    position:relative; background:rgba(255,255,255,0.03); border:2px solid #333; padding:18px; margin-bottom:12px; transition: all 160ms ease; cursor:pointer;
  }
  .card:hover { border-color:#00ff87; background: rgba(0,255,135,0.05); }
  .card::after { content:""; display:block; }
  .card:hover::after {
    content: "‚Üí CLICK TO SELECT";
    position:absolute; bottom:10px; right:12px; color:#00ff87; font-size:11px; letter-spacing:2px; font-weight:900; text-transform:uppercase;
  }
  .card.selected { border-color:#00ff87; background: rgba(0,255,135,0.12); box-shadow: 0 6px 18px rgba(0,255,135,0.04); }

  .badge-refund { font-size:11px; padding:6px 8px; border-radius:6px; font-weight:900; text-transform:uppercase; letter-spacing:1px; display:inline-block; margin-top:8px; }
  .badge-refund.true { color:#60efff; border:1px solid rgba(96,239,255,0.12); background: rgba(96,239,255,0.02); }
  .badge-refund.false { color:#ff8080; border:1px solid rgba(255,128,128,0.08); background: rgba(255,128,128,0.02); }

  /* ---------- Chat Modal (bottom) ---------- */
  .chat-backdrop {
    position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.35); opacity:0; pointer-events:none; z-index:1100; transition: opacity 240ms ease;
    backdrop-filter: blur(2px);
  }
  body.chat-open .chat-backdrop { opacity:1; pointer-events:auto; }

  .chat-modal {
    position:fixed; left:0; right:0; bottom:0; transform: translateY(100%); transition: transform 360ms cubic-bezier(.2,.9,.2,1); z-index:1150;
    display:flex; justify-content:center; pointer-events:auto;
  }
  .chat-modal.open { transform: translateY(0%); }

  .chat-pane {
    width:100%; max-width:1080px; margin:0 16px; border-radius:12px 12px 0 0; overflow:hidden;
    border: 1px solid rgba(0,255,135,0.18);
    box-shadow: 0 -10px 40px rgba(0,0,0,0.6), 0 8px 24px rgba(0,255,135,0.04);
    background: rgba(6,6,6,0.55);
    backdrop-filter: blur(18px) saturate(120%);
    -webkit-backdrop-filter: blur(18px) saturate(120%);
  }

  .chat-pane { height: 40vh; }
  @media (max-width: 768px) { .chat-pane { height: 80vh; } }

  .chat-header {
    display:flex; justify-content:space-between; align-items:center; padding:12px 16px; border-bottom:1px solid rgba(255,255,255,0.03);
  }
  .chat-title { color:#00ff87; font-weight:900; text-transform:uppercase; letter-spacing:1px; }
  .chat-close { background:transparent; border:none; color:#ddd; font-size:20px; cursor:pointer; padding:8px; }
  .chat-close:hover { color:#fff; transform:rotate(90deg); }

  .chat-body { display:flex; flex-direction:column; height: calc(100% - 120px); padding:12px 16px; overflow:auto; }
  .messages { flex:1; overflow:auto; padding-right:8px; }
  .message { margin-bottom:12px; }
  .message .content { display:inline-block; padding:10px 12px; border-radius:6px; max-width:72%; font-size:13px; line-height:1.45; }
  .message.ai .content { background: rgba(0,255,135,0.07); border-left:3px solid #00ff87; color:#e6ffe9; }
  .message.user { display:flex; justify-content:flex-end; }
  .message.user .content { background: rgba(96,239,255,0.08); border-right:3px solid #60efff; color:#e6fbff; }

  .chat-input-area { display:flex; gap:8px; padding:12px 16px; border-top:1px solid rgba(255,255,255,0.03); }
  .chat-input { flex:1; padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:rgba(0,0,0,0.25); color:#fff; font-family:'Courier New',monospace; font-weight:700; }
  .chat-send { padding:10px 14px; background:#00ff87; border:none; color:#0a0a0a; font-weight:900; cursor:pointer; border-radius:8px; }

  .fab {
    position:fixed; right:16px; bottom: calc(16px + env(safe-area-inset-bottom)); z-index:1160;
    width:58px; height:58px; border-radius:50%; background:#00ff87; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    transition: transform 360ms cubic-bezier(.2,.9,.2,1), opacity 200ms ease;
    border: 2px solid rgba(0,255,135,0.12);
  }
  .fab .emoji { font-size:20px; }
  .fab:active { transform: scale(.98); }

  body.chat-open .fab { transform: translateY(-40vh); }
  @media (max-width:768px) { body.chat-open .fab { transform: translateY(-80vh); } }

  .fab[aria-hidden="true"] { opacity:0; pointer-events:none; }

  /* ---------- Itinerary ---------- */
  .itinerary-builder { 
    padding:16px; 
    background: rgba(0,255,135,0.03); 
    border:2px solid rgba(0,255,135,0.06);
    display: flex;
    flex-direction: column;
  }
  .itinerary-title { color:#00ff87; font-weight:900; margin-bottom:10px; text-transform:uppercase; font-size:13px; letter-spacing:1px; }
  .itinerary-items-container { flex: 1; overflow:auto; padding-right:6px; max-height:42vh; }
  .itinerary-item {
    background: rgba(0,0,0,0.36); border-left:3px solid #00ff87; padding:12px; margin-bottom:10px; opacity:0; transform: translateY(8px);
    animation: dropIn 360ms ease forwards;
  }
  @keyframes dropIn { to { opacity:1; transform:none; } }

  .itinerary-item-title { color:#00ff87; font-weight:900; margin-bottom:6px; font-size:12px; text-transform:uppercase; }
  .itinerary-item-details { color:#ccc; font-size:13px; line-height:1.4; }
  .itinerary-total { margin-top:10px; display:flex; justify-content:space-between; align-items:center; padding-top:10px; border-top:1px solid #222; }
  .itinerary-total-price { color:#00ff87; font-weight:900; font-size:18px; }

  .itinerary-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 16px;
  }

  .tiny-btn {
    display:inline-block; padding:8px 10px; margin-left:8px; border-radius:6px; background:transparent; border:1px solid #666; color:#ccc; font-weight:700; font-size:12px; cursor:pointer;
    transition: all 180ms ease;
  }
  .tiny-btn:hover { box-shadow: 0 6px 14px rgba(0,0,0,0.6), 0 6px 12px rgba(100,100,100,0.04); border-color:#999; color:#fff; transform: translateY(-2px); }

  .sr-only { position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
</style>
</head>
<body>
  <!-- Top Buttons -->
  <button class="settings-btn" onclick="showConfig()">‚öô CONFIG</button>
  <button class="settings-btn help-btn" onclick="showHelp()">‚ùì HELP</button>

  <!-- Config Modal -->
  <div class="modal" id="configModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="configTitle">
      <button class="modal-close" onclick="closeConfig()" aria-label="Close config">√ó</button>
      <div id="configTitle" class="modal-title">‚ö° API Setup</div>
      <div class="modal-text">Optional: Connect real APIs for live data. Demo mode works without setup.</div>
      <div class="form-group">
        <label class="form-label">Amadeus API Key</label>
        <input type="text" id="amadeusKey" placeholder="Optional">
      </div>
      <div class="form-group">
        <label class="form-label">Amadeus Secret</label>
        <input type="password" id="amadeusSecret" placeholder="Optional">
      </div>
      <div class="form-group">
        <label class="form-label">OpenAI Key (Optional)</label>
        <input type="password" id="openaiKey" placeholder="Optional">
      </div>
      <button class="settings-btn" onclick="saveConfig()">Save</button>
      <button class="settings-btn" style="right:auto; margin-left:12px; background:transparent; border:2px solid #333; color:#888;" onclick="closeConfig()">Cancel</button>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal" id="helpModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="helpTitle" style="max-width:800px;">
      <button class="modal-close" onclick="closeHelp()" aria-label="Close help">√ó</button>
      <div id="helpTitle" class="modal-title">üìö Help Guide</div>
      <div class="modal-text">
        <strong style="color:#00ff87;">Demo Mode (Default)</strong><br>
        Works immediately with realistic data. Perfect for testing.<br><br>
        <strong style="color:#00ff87;">Live Mode (Optional)</strong><br>
        Connect APIs for real flight/hotel data:<br><br>
        1. Get Amadeus API (Free): <a href="https://developers.amadeus.com/register" target="_blank" style="color:#60efff;">developers.amadeus.com/register</a><br>
        2. Create app in "Self-Service Workspace"<br>
        3. Copy API Key + Secret<br>
        4. Paste in Config (‚öô button)<br><br>
        OpenAI is optional for enhanced AI chat.
      </div>
      <button class="settings-btn" onclick="openConfigFromHelp()">Setup APIs</button>
      <button class="settings-btn" style="background:transparent; border:2px solid #333; color:#888; margin-left:8px;" onclick="closeHelp()">Got It</button>
    </div>
  </div>

  <!-- Start Page -->
  <div class="start-page" id="startPage">
    <div class="logo-large">TRAVELAI</div>
    <div class="tagline">AI-Powered Journey Planning</div>

    <div class="intent-wrapper">
      <textarea class="intent-input" id="intentInput" placeholder="Where do you want to go? Tell me your plans..."></textarea>
      <div class="intent-actions">
        <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()"><span>üé§</span> <span id="voiceText">SPEAK</span></button>
        <button class="settings-btn" onclick="startJourney()" style="background:#00ff87; color:#0a0a0a;">BEGIN ‚Üí</button>
      </div>
    </div>

    <div class="suggestions">
      <div class="suggestion" onclick="fillIntent('Weekend trip to Paris')">Weekend Getaway</div>
      <div class="suggestion" onclick="fillIntent('Business trip to London next week')">Business Travel</div>
      <div class="suggestion" onclick="fillIntent('Beach vacation in Bali')">Beach Vacation</div>
      <div class="suggestion" onclick="fillIntent('Multi-city: Berlin, Prague, Vienna')">Multi-City</div>
    </div>
  </div>

  <!-- Main App -->
  <div class="main-app" id="mainApp" aria-hidden="true">
    <div class="header">
      <div>
        <span class="logo">TRAVELAI</span>
        <span class="badge" id="modeBadge">DEMO MODE</span>
      </div>
    </div>

    <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="3">
      <div class="progress-step active" id="step0">Now Booking</div>
      <div class="progress-step" id="step1">Hotel</div>
      <div class="progress-step" id="step2">Dining</div>
      <div class="progress-step" id="step3">Review</div>
      <div class="progress-step" id="step4">Complete</div>
    </div>

    <div class="content" role="main">
      <!-- Left: Search -->
      <div class="panel" aria-label="Search panel">
        <div class="panel-title">SEARCH</div>

        <div class="tabs" role="tablist">
          <button class="tab active" onclick="switchTab(0)" role="tab" aria-selected="true">FLIGHTS</button>
          <button class="tab" onclick="switchTab(1)" role="tab">HOTELS</button>
          <button class="tab" onclick="switchTab(2)" role="tab">FOOD</button>
        </div>

        <div class="tab-content active" id="tab0">
          <div class="search-form">
            <div class="form-group">
              <label class="form-label">From</label>
              <input type="text" id="from" value="BER" placeholder="Airport Code">
            </div>
            <div class="form-group">
              <label class="form-label">To</label>
              <input type="text" id="to" value="CDG" placeholder="Airport Code">
            </div>
            <div class="form-group">
              <label class="form-label">Date</label>
              <input type="date" id="date" value="2025-11-01">
            </div>
            <button class="search-btn" onclick="search('flight')">SEARCH FLIGHTS</button>
          </div>
          <div id="flightResults" class="results" aria-live="polite"></div>
        </div>

        <div class="tab-content" id="tab1">
          <div class="search-form">
            <div class="form-group">
              <label class="form-label">City</label>
              <input type="text" id="city" value="Paris">
            </div>
            <div class="form-group">
              <label class="form-label">Check-in</label>
              <input type="date" id="checkin" value="2025-11-01">
            </div>
            <div class="form-group">
              <label class="form-label">Check-out</label>
              <input type="date" id="checkout" value="2025-11-03">
            </div>
            <button class="search-btn" onclick="search('hotel')">SEARCH HOTELS</button>
          </div>
          <div id="hotelResults" class="results" aria-live="polite"></div>
        </div>

        <div class="tab-content" id="tab2">
          <div class="search-form">
            <div class="form-group">
              <label class="form-label">Location</label>
              <input type="text" id="location" value="Paris">
            </div>
            <div class="form-group">
              <label class="form-label">Cuisine</label>
              <select id="cuisine">
                <option>All</option>
                <option>French</option>
                <option>Italian</option>
                <option>Japanese</option>
              </select>
            </div>
            <button class="search-btn" onclick="search('restaurant')">FIND RESTAURANTS</button>
          </div>
          <div id="restaurantResults" class="results" aria-live="polite"></div>
        </div>
      </div>

      <!-- Right: Itinerary & AI Assistant -->
      <div class="panel" aria-label="Assistant and itinerary">
        <div class="panel-title">AI ASSISTANT</div>

        <div class="itinerary-builder" id="itinerary">
          <div class="itinerary-title">üìã YOUR TRIP</div>

          <div class="itinerary-items-container">
            <div id="itineraryItems">
              <div class="empty-state">Select items to build your itinerary</div>
            </div>
          </div>

          <div class="itinerary-total" id="totalSection" style="display:none;">
            <div class="itinerary-total-label">TOTAL COST</div>
            <div class="itinerary-total-price" id="totalPrice">‚Ç¨0</div>
          </div>

          <div class="itinerary-buttons">
            <button id="completeBtn"
              class="settings-btn itinerary-btn"
              style="background:#00ff87;color:#0a0a0a;"
              onclick="completeBooking()" disabled>
              COMPLETE BOOKING ‚Üí
            </button>
            <button class="settings-btn itinerary-btn"
              style="background:transparent;border:2px solid #333;color:#888;"
              onclick="resetTrip()">
              RESET TRIP
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat backdrop & modal -->
  <div class="chat-backdrop" id="chatBackdrop" onclick="closeChat()" aria-hidden="true"></div>

  <div class="chat-modal" id="chatModal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="AI Assistant">
    <div class="chat-pane" role="document">
      <div class="chat-header">
        <div class="chat-title">üí¨ AI Assistant</div>
        <button class="chat-close" id="chatCloseBtn" aria-label="Close chat" onclick="closeChat()">√ó</button>
      </div>

      <div class="chat-body">
        <div class="messages" id="messages" aria-live="polite"></div>

        <div class="chat-input-area">
          <input id="chatInput" class="chat-input" placeholder="Ask me anything..." aria-label="Chat input" />
          <button class="chat-send" id="chatSend" onclick="sendMsg()" aria-label="Send message">SEND</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating button to reopen chat -->
  <button class="fab" id="fab" aria-label="Open AI Assistant" title="AI Assistant (chat)" onclick="toggleChat()" aria-hidden="false">
    <span class="emoji">üí¨</span>
  </button>

<script>
  let config = { demoMode: true };
  const saved = localStorage.getItem('travelAiConfig');
  if (saved) config = JSON.parse(saved);

  let itinerary = { flight: null, hotel: null, restaurant: null };

  function showConfig() { document.getElementById('configModal').classList.add('show'); document.getElementById('configModal').setAttribute('aria-hidden','false'); }
  function closeConfig() { document.getElementById('configModal').classList.remove('show'); document.getElementById('configModal').setAttribute('aria-hidden','true'); }
  function saveConfig() {
    config.amadeusKey = document.getElementById('amadeusKey').value.trim();
    config.amadeusSecret = document.getElementById('amadeusSecret').value.trim();
    config.openaiKey = document.getElementById('openaiKey').value.trim();
    if (config.amadeusKey) { config.demoMode = false; document.getElementById('modeBadge').textContent = 'LIVE MODE'; }
    localStorage.setItem('travelAiConfig', JSON.stringify(config));
    closeConfig();
    addMsg('ai','‚úÖ Settings saved!');
  }
  function showHelp() { document.getElementById('helpModal').classList.add('show'); document.getElementById('helpModal').setAttribute('aria-hidden','false'); }
  function closeHelp() { document.getElementById('helpModal
